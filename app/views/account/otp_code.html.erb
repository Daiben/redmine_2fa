<div id="login-form">
  <%= form_tag(otp_code_confirm_path) do %>
    <% if params[:autologin] %>
      <%= hidden_field_tag 'autologin', params[:autologin] %>
    <% end %>
    <table style="width: 350px;">
      <% if @user.has_sms_auth? || @user.has_google_auth? || @user.telegram_account&.active? %>
        <tr>
          <td align="right"><label for="otp_code"><%= t 'redmine_2fa.auth_code' %>:</label></td>
          <td align="right"><%= text_field_tag :otp_code, nil, autocomplete: 'off', autofocus: true %></td>
        </tr>
        <tr id="otpCodeResentInstruction" style="display: none">
          <td align="center" colspan="2">
            <%= t('redmine_2fa.resend.instruction_html', timeout: 30) %>
          </td>
        </tr>
        <tr>
          <td align="left">
            <% unless @user.has_google_auth? %>
              <%= link_to t('redmine_2fa.resend.link'), otp_code_resend_path, remote: true, id: 'otpCodeResendLink' %>
            <% end %>
          </td>
          <td align="right" colspan="1">
            <input type="submit" name="login" value="<%= l(:button_login) %> &#187;"/>
          </td>
        </tr>
      <% elsif @user.has_telegram_auth? %>
        <tr>
          <td align="left" colspan="2">
            <strong><%= t 'redmine_2fa.new_connection.title' %></strong>
            <%= t 'redmine_2fa.new_connection.instruction_html', bot_name: Setting.plugin_redmine_2fa['bot_name'] %>
          </td>
        </tr>
      <% end %>

    </table>
  <% end %>
</div>

<% if @user.has_google_auth? %>
  <%= render 'qr_code' %>
<% end %>

<% content_for :header_tags do %>
  <%= javascript_include_tag 'redmine_2fa', plugin: 'redmine_2fa' %>
  <%= stylesheet_link_tag 'redmine_2fa', plugin: 'redmine_2fa' %>
<% end %>


<% unless @hide_countdown or @user.has_google_auth? %>
  <%= javascript_tag 'window.onload = function () {startOtpTimer();};' %>
<% end %>
